{"version":3,"sources":["../../src/query_ctrl.js"],"names":["GenericDatasourceQueryCtrl","$scope","$injector","scope","target","type","sourceTypeTab","displayHostgroupBox","displayApplicationBox","displayApplicationByHostGroupBox","displayWebAppBox","displayPageFamilyBox","targetID","metricID","pageFamilyID","secondTargetID","unit","rate","granularity","granularityTab","query","datasource","metricFindQuery","metricApplicationsFindQuery","metricWAFindQuery","ret","ENHANCEDmetricFindHost_groupQuery","testPrint","metricFindApplicationQuery","metricFindWebAppQuery","DOMextractedRefID","$","document","activeElement","parents","find","text","metricFindPageFamilyQuery","disableAllBoxBool","toggleHostBool","toggleApplicationBool","toggleApplicationByHostGroupBool","toggleWebbAppBool","togglePageFamilyBool","panelCtrl","refresh","console","log","QueryCtrl","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\n  constructor($scope, $injector)  {\n    super($scope, $injector);\n    this.scope = $scope;\n    // Critical attribute needed in datasource spec (self tests)\n    this.target.target = 'unused attribute';\n    // Attribute type correspond to source type (Host group, webapp ...)\n    this.target.type = this.target.type;\n    // All source type available\n    this.target.sourceTypeTab= ['Host group', 'Application', 'Application/HG', 'WebApp', 'PageFamily'];\n    // All boolean needed to display correct box (HostGroup, application .... default is HostGroup)\n    this.target.displayHostgroupBox = this.target.displayHostgroupBox;\n    this.target.displayApplicationBox = this.target.displayApplicationBox;\n    this.target.displayApplicationByHostGroupBox = this.target.displayApplicationByHostGroupBox;\n    this.target.displayWebAppBox = this.target.displayWebAppBox;\n    this.target.displayPageFamilyBox = this.target.displayPageFamilyBox;\n    // Attribute targetID is the id of target selected (can be host_group.id, app.id)\n    this.target.targetID=this.target.targetID || \"\";\n    // Attribute metricID is the id of metric selected\n    this.target.metricID=this.target.metricID;\n    // Attribute pageFamilyID is the id of the page family selected\n    this.target.pageFamilyID=this.target.pageFamilyID;\n    // Attribute secondTargetID is the id of the host_group.id selected in 'Application/HG' source type\n    this.target.secondTargetID=this.target.secondTargetID;\n    // Attribute unit is the unit of the metric selected (or can be 'none')\n    this.target.unit='';\n    // Attribute rate is the rate of the metric selected (can be empty) \n    this.target.rate='';\n    // Attribute granularity is the granularity selected\n    this.target.granularity=this.target.granularity;\n    // Granularities avalaible\n    this.target.granularityTab=[{ \"value\": 60, \"text\": \"60 seconds\" },\n                                { \"value\": 300, \"text\": \"5 minutes\" },\n                                { \"value\": 3600, \"text\": \"1 hour\" },\n                                { \"value\": 21600, \"text\": \"6 hours\" },\n                                { \"value\": 86400, \"text\": \"1 day\" }];\n  }\n\n  // These methods are used by boxes in query.editor.html \n\n  // Will go to end point '/metricsHG' wich retreives all metrics avalaible for hostGroup\n  getMetricOptions(query) { \n    return this.datasource.metricFindQuery(query || '');\n  }\n\n  // Will go to end point '/metricsApplication' wich retreives all metrics avalaible for application\n  getMetricApplicationsOptions(query) {   \n    return this.datasource.metricApplicationsFindQuery(query || '');\n  }\n\n  // Will go to end point '/metricsWebApp' wich retreives all metrics avalaible for webapp\n  getMetricWAOptions(query) { \n    return this.datasource.metricWAFindQuery(query || '');\n  }\n\n  // Will go to end point '/getHost_group' wich retreives all host groups avalaible\n  getHost_groupOptions(query) {\n    var ret = this.datasource.ENHANCEDmetricFindHost_groupQuery(query || '');\n    this.datasource.testPrint();\n    return ret;\n    \n  }\n  \n  // Will go to end point '/getApplicationOptions' wich retreives all applications avalaible\n  getApplicationOptions(query) {\n    return this.datasource.metricFindApplicationQuery(query || '');\n  }  \n\n  // Will go to end point '/getWebAppOptions' wich retreives all webapps avalaible\n  getWebAppOptions(query) {\n    return this.datasource.metricFindWebAppQuery(query || '');\n  }\n  \n  // Will go to end point '/getPageFamilyOptions' wich retreives all page families avalaible for a webapp\n  getPageFamilyOptions() {\n    this.target.DOMextractedRefID = $(document.activeElement).parents(\"query-editor-row\").find(\".gf-form-query-letter-cell-letter\").text();\n    return this.datasource.metricFindPageFamilyQuery(this.target.DOMextractedRefID);\n  }  \n \n  // When changing source type, bind False to all boolean (all boxes disapear)\n  disableAllBoxBool(){\n    this.target.displayHostgroupBox = false;\n    this.target.displayApplicationBox = false;\n    this.target.displayWebAppBox = false;\n    this.target.displayApplicationByHostGroupBox = false;\n    this.target.displayPageFamilyBox = false;\n  }\n\n  // If source type 'host group' is selected, only his boolean is set to True\n  toggleHostBool() {\n    this.disableAllBoxBool();\n    this.target.displayHostgroupBox = true;\n  }\n\n  // If source type 'application' is selected, only his boolean is set to True\n  toggleApplicationBool() {\n    this.disableAllBoxBool();\n    this.target.displayApplicationBox = true;\n  }\n\n  // If source type 'application/HG' is selected, only his boolean is set to True\n  toggleApplicationByHostGroupBool() {\n    this.disableAllBoxBool();\n    this.target.displayApplicationByHostGroupBox = true;\n  }\n\n  // If source type 'webapp' is selected, only his boolean is set to True\n  toggleWebbAppBool(){\n    this.disableAllBoxBool();\n    this.target.displayWebAppBox = true;\n  }\n\n  // If source type 'pageFamily' is selected, only his boolean is set to True\n  togglePageFamilyBool(){\n    this.disableAllBoxBool();\n    this.target.displayPageFamilyBox = true;\n  }\n\n  // Method triggered by source type selection (a new query is being made), cleaning all up\n  runningSelect(){\n    // Reset attributes\n    this.target.targetID=\"\"\n    this.target.metricID=\"\"\n    this.target.pageFamilyID=\"\";\n    this.target.secondTargetID=\"\";\n    this.target.granularity='';\n    this.target.unit='';\n    this.target.rate='';\n    // Toggling boolean depending of selected case of combobox 'Source type' (this will display concerned boxes):\n    if(this.target.type == \"Host group\") {\n      this.toggleHostBool();\n    }\n    if(this.target.type == \"Application\") {\n      this.toggleApplicationBool();\n    }\n    if(this.target.type == \"Application/HG\") {\n      this.toggleApplicationByHostGroupBool();\n    }\n    if(this.target.type == \"WebApp\") {\n      this.toggleWebbAppBool();\n    }\n    if(this.target.type == 'PageFamily'){\n      this.togglePageFamilyBool();\n    }\n  }\n\n  // Method triggering /query end point\n  onChangeInternal() {\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\n    console.log(\"REFRESHED\");\n  }\n\n    // Debugging purpose\n    toString2(){\n      console.log(\"this.target.target \" + this.target.target);\n      console.log(\"this.target.type \" + this.target.type);\n      console.log(\"displayHostgroupBox : \"+this.target.displayHostgroupBox);\n      console.log(\"displayApplicationBox : \"+this.target.displayApplicationBox);\n      console.log(\"displayWebAppBox : \"+this.target.displayWebAppBox);\n      console.log(\"displayPageFamilyBox : \"+this.target.displayPageFamilyBox);\n      console.log(\"this.target.targetID : \"+this.target.targetID);\n      console.log(\"this.target.metricID : \"+this.target.metricID);\n      console.log(\"this.target.pageFamilyID : \"+this.target.pageFamilyID);\n      console.log(\"this.target.secondTargetID : \"+this.target.secondTargetID);\n      console.log(\"this.target.granularity : \"+this.target.granularity);    \n      console.log(\"this.target.unit : \"+this.target.unit);\n      console.log(\"this.target.rate : \"+this.target.rate);\n    }\n}\n\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n\n"]}